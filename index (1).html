<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø³Ø®ØªÙŠ Ø§Ù„Ø±Ù‚Ù…ÙŠØ© | Digital Twin AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --secondary: #ec4899;
            --accent: #06b6d4;
            --dark: #0f172a;
            --darker: #020617;
            --light: #f8fafc;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            min-height: 100vh;
            color: var(--light);
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(236, 72, 153, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(6, 182, 212, 0.1) 0%, transparent 40%);
            animation: bgMove 20s ease-in-out infinite;
        }

        @keyframes bgMove {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-5%, -5%) rotate(5deg); }
        }

        /* Container */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 40px 20px;
            position: relative;
        }

        .logo {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            animation: glow 3s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 20px rgba(99, 102, 241, 0.5)); }
            to { filter: drop-shadow(0 0 30px rgba(236, 72, 153, 0.5)); }
        }

        .subtitle {
            color: #94a3b8;
            font-size: 1.2rem;
            font-weight: 500;
        }

        /* Sections */
        .section {
            display: none;
            animation: fadeIn 0.6s ease-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 60px -12px rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.3);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: #e2e8f0;
            font-size: 1.1rem;
        }

        input[type="text"],
        select,
        textarea {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            background: rgba(15, 23, 42, 0.8);
            color: var(--light);
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .reaction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .reaction-card {
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .reaction-card:hover {
            border-color: var(--primary);
            transform: scale(1.02);
        }

        .reaction-card label {
            font-size: 0.95rem;
            color: #94a3b8;
            margin-bottom: 12px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 16px 32px;
            border: none;
            border-radius: 16px;
            font-family: inherit;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 10px 30px -5px rgba(99, 102, 241, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px -5px rgba(99, 102, 241, 0.6);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--accent);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 30px;
        }

        /* Personality Result */
        .personality-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin: 0 auto 20px;
            box-shadow: 0 0 40px rgba(99, 102, 241, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .digital-name {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .speaking-style {
            color: #94a3b8;
            font-size: 1.1rem;
            font-style: italic;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: #94a3b8;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 10px;
        }

        .stat-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease-out;
        }

        .anger { color: var(--danger); }
        .anger .stat-fill { background: linear-gradient(90deg, var(--danger), #f87171); }
        
        .kindness { color: var(--secondary); }
        .kindness .stat-fill { background: linear-gradient(90deg, var(--secondary), #f472b6); }
        
        .intelligence { color: var(--accent); }
        .intelligence .stat-fill { background: linear-gradient(90deg, var(--accent), #67e8f9); }
        
        .social { color: var(--success); }
        .social .stat-fill { background: linear-gradient(90deg, var(--success), #34d399); }

        /* Chat Interface */
        .chat-container {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 24px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .chat-header {
            background: rgba(30, 41, 59, 0.8);
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .emotion-meter {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .emotion {
            font-size: 1.8rem;
            opacity: 0.3;
            transition: all 0.3s ease;
            filter: grayscale(100%);
        }

        .emotion.active {
            opacity: 1;
            filter: grayscale(0%);
            transform: scale(1.2);
            animation: bounce 0.5s;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1.2); }
            50% { transform: scale(1.4); }
        }

        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 15px 20px;
            border-radius: 20px;
            animation: messageSlide 0.3s ease-out;
            position: relative;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            align-self: flex-start;
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-bottom-right-radius: 4px;
        }

        .message.ai {
            align-self: flex-end;
            background: rgba(236, 72, 153, 0.2);
            border: 1px solid rgba(236, 72, 153, 0.3);
            border-bottom-left-radius: 4px;
        }

        .message-header {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .chat-input-area {
            padding: 20px;
            background: rgba(30, 41, 59, 0.8);
            display: flex;
            gap: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            background: rgba(15, 23, 42, 0.8);
            color: var(--light);
            font-family: inherit;
            font-size: 1rem;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Self Confrontation Mode */
        .confrontation-mode {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            height: 500px;
        }

        .confrontation-side {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 20px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .confrontation-side.you {
            border-color: var(--primary);
        }

        .confrontation-side.ai {
            border-color: var(--secondary);
        }

        .side-header {
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 15px;
        }

        .side-messages {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .vs-badge {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--danger), #dc2626);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.2rem;
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.4);
            z-index: 10;
        }

        .confrontation-container {
            position: relative;
        }

        /* Quick Replies */
        .quick-replies {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
            padding: 0 20px 20px;
        }

        .quick-reply {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: #94a3b8;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .quick-reply:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--primary);
            color: var(--light);
        }

        /* Loading Animation */
        .loading {
            display: inline-flex;
            gap: 5px;
        }

        .loading span {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: loading 1.4s infinite ease-in-out both;
        }

        .loading span:nth-child(1) { animation-delay: -0.32s; }
        .loading span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes loading {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .logo { font-size: 2.5rem; }
            .stats-grid { grid-template-columns: 1fr; }
            .confrontation-mode { grid-template-columns: 1fr; height: auto; }
            .vs-badge { display: none; }
            .reaction-grid { grid-template-columns: 1fr; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Typing Indicator */
        .typing {
            display: flex;
            gap: 5px;
            padding: 15px 20px;
            background: rgba(236, 72, 153, 0.1);
            border-radius: 20px;
            align-self: flex-end;
            width: fit-content;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--secondary);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        /* Saved Personalities */
        .saved-list {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .saved-item {
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .saved-item:hover {
            border-color: var(--primary);
            transform: translateX(-10px);
        }

        .saved-info h3 {
            color: var(--light);
            margin-bottom: 5px;
        }

        .saved-info p {
            color: #64748b;
            font-size: 0.9rem;
        }

        /* Mood Indicator */
        .mood-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(15, 23, 42, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 100;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .mood-emoji {
            font-size: 2rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .mood-text {
            font-weight: 700;
            color: var(--light);
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Mood Indicator -->
    <div class="mood-indicator hidden" id="moodIndicator">
        <span class="mood-emoji" id="moodEmoji">ğŸ˜</span>
        <span class="mood-text" id="moodText">Ù…Ø­Ø§ÙŠØ¯</span>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="logo">ğŸ‘¤ Ù†Ø³Ø®ØªÙŠ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</h1>
            <p class="subtitle">Ø£Ù†Ø´Ø¦ Ù†Ø³Ø®Ø© AI Ù…Ù† Ø´Ø®ØµÙŠØªÙƒ ÙˆØªØ­Ø¯Ø« Ù…Ø¹Ù‡Ø§!</p>
        </header>

        <!-- Section 1: Create Personality -->
        <section class="section active" id="createSection">
            <div class="card">
                <h2 style="margin-bottom: 25px; font-size: 1.8rem;">ğŸ¯ Ø£Ù†Ø´Ø¦ Ø´Ø®ØµÙŠØªÙƒ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</h2>
                
                <div class="form-group">
                    <label>ğŸ‘¤ Ø§Ø³Ù…Ùƒ</label>
                    <input type="text" id="userName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." required>
                </div>

                <h3 style="margin: 30px 0 20px; color: var(--accent);">ğŸ­ Ø±Ø¯ÙˆØ¯ Ø£ÙØ¹Ø§Ù„Ùƒ ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ù‚Ù</h3>
                
                <div class="reaction-grid">
                    <div class="reaction-card">
                        <label>ğŸ˜¡ Ù„Ù…Ø§ Ø­Ø¯ ÙŠØ´ØªÙ…ÙƒØŸ</label>
                        <select id="insultReaction">
                            <option value="calm">ğŸ§˜ Ø£Ù‡Ø¯Ù‰ Ù†ÙØ³ÙŠ ÙˆØ£ØªØ¬Ø§Ù‡Ù„</option>
                            <option value="angry">ğŸ˜¤ Ø£Ø±Ø¯ Ø¨Ø¹ØµØ¨ÙŠØ©</option>
                            <option value="sarcastic">ğŸ˜ Ø£Ø±Ø¯ Ø¨Ø³Ø®Ø±ÙŠØ©</option>
                            <option value="smart">ğŸ§  Ø£Ø±Ø¯ Ø¨Ø°ÙƒØ§Ø¡ ÙˆÙ‡Ø¯ÙˆØ¡</option>
                        </select>
                    </div>

                    <div class="reaction-card">
                        <label>ğŸ‰ ØµØ­Ø§Ø¨Ùƒ Ø¹Ø§ÙŠØ²ÙŠÙ† ÙŠØ®Ø±Ø¬ÙˆØ§ØŸ</label>
                        <select id="friendsReaction">
                            <option value="excited">ğŸ¤© ÙŠÙ„Ø§ Ø¨ÙŠÙ†Ø§ ÙÙˆØ±Ø§Ù‹!</option>
                            <option value="tired">ğŸ˜´ Ù…Ø¹Ù†Ø¯ÙŠØ´ Ø·Ø§Ù‚Ø© Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡</option>
                            <option value="busy">ğŸ’¼ Ø¹Ù†Ø¯ÙŠ Ø´ØºÙ„ ÙƒØªÙŠØ±</option>
                            <option value="maybe">ğŸ¤” Ù‡ÙÙƒØ± Ùˆ Ø£Ù‚ÙˆÙ„Ùƒ</option>
                        </select>
                    </div>

                    <div class="reaction-card">
                        <label>ğŸ’¼ Ø¬Ø§Ù„Ùƒ Ø´ØºÙ„ Ø¬Ø¯ÙŠØ¯ØŸ</label>
                        <select id="workReaction">
                            <option value="enthusiastic">ğŸ”¥ Ù…ØªØ­Ù…Ø³ Ùˆ Ø£Ø¨Ø¯Ø£ ÙÙˆØ±Ø§Ù‹</option>
                            <option value="cautious">âš ï¸ Ù‡ÙÙƒØ± ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙˆÙ„</option>
                            <option value="stressed">ğŸ˜° Ù‡ØªÙˆØªØ± Ø´ÙˆÙŠØ©</option>
                            <option value="confident">ğŸ’ª ÙˆØ§Ø«Ù‚ Ù…Ù† Ù†ÙØ³ÙŠ</option>
                        </select>
                    </div>

                    <div class="reaction-card">
                        <label>ğŸ†˜ Ø­Ø¯ Ø·Ù„Ø¨ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ</label>
                        <select id="helpReaction">
                            <option value="immediate">ğŸƒ Ø£Ø³Ø§Ø¹Ø¯ ÙÙˆØ±Ø§Ù‹</option>
                            <option value="check">â° Ù‡Ø´ÙˆÙ Ù„Ùˆ Ø¹Ù†Ø¯ÙŠ ÙˆÙ‚Øª</option>
                            <option value="guide">ğŸ“š Ù‡Ø¯ÙŠÙ‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©</option>
                            <option value="delegate">ğŸ‘¥ Ù‡Ø¬ÙŠØ¨ Ø­Ø¯ ÙŠØ³Ø§Ø¹Ø¯Ù‡</option>
                        </select>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 25px;">
                    <label>âœ¨ ÙˆØµÙ Ø¥Ø¶Ø§ÙÙŠ Ù„Ø´Ø®ØµÙŠØªÙƒ</label>
                    <textarea id="extraDescription" placeholder="Ø§ÙƒØªØ¨ Ø£ÙŠ ØªÙØ§ØµÙŠÙ„ ØªØ§Ù†ÙŠØ© Ø¹Ù† Ø´Ø®ØµÙŠØªÙƒ..."></textarea>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="generatePersonality()">
                        ğŸš€ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
                    </button>
                    <button class="btn btn-secondary" onclick="showSavedPersonalities()">
                        ğŸ“ Ø§Ù„Ø´Ø®ØµÙŠØ§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
                    </button>
                </div>
            </div>

            <!-- Saved Personalities List -->
            <div class="card hidden" id="savedSection">
                <h3 style="margin-bottom: 20px;">ğŸ“ Ø´Ø®ØµÙŠØ§ØªÙƒ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h3>
                <div class="saved-list" id="savedList"></div>
                <button class="btn btn-secondary" onclick="hideSavedPersonalities()" style="margin-top: 20px;">
                    Ø±Ø¬ÙˆØ¹
                </button>
            </div>
        </section>

        <!-- Section 2: Personality Result -->
        <section class="section" id="resultSection">
            <div class="card">
                <div class="personality-header">
                    <div class="avatar" id="resultAvatar">ğŸ¤–</div>
                    <h2 class="digital-name" id="digitalName">Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</h2>
                    <p class="speaking-style" id="speakingStyle">Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„ÙƒÙ„Ø§Ù…</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card anger">
                        <div class="stat-label">ğŸ˜¡ Ø§Ù„Ø¹ØµØ¨ÙŠØ©</div>
                        <div class="stat-value" id="angerValue">50%</div>
                        <div class="stat-bar">
                            <div class="stat-fill" id="angerBar" style="width: 50%"></div>
                        </div>
                    </div>

                    <div class="stat-card kindness">
                        <div class="stat-label">ğŸ¤ Ø§Ù„Ø·ÙŠØ¨Ø©</div>
                        <div class="stat-value" id="kindnessValue">50%</div>
                        <div class="stat-bar">
                            <div class="stat-fill" id="kindnessBar" style="width: 50%"></div>
                        </div>
                    </div>

                    <div class="stat-card intelligence">
                        <div class="stat-label">ğŸ§  Ø§Ù„Ø°ÙƒØ§Ø¡</div>
                        <div class="stat-value" id="intelligenceValue">50%</div>
                        <div class="stat-bar">
                            <div class="stat-fill" id="intelligenceBar" style="width: 50%"></div>
                        </div>
                    </div>

                    <div class="stat-card social">
                        <div class="stat-label">ğŸ‰ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©</div>
                        <div class="stat-value" id="socialValue">50%</div>
                        <div class="stat-bar">
                            <div class="stat-fill" id="socialBar" style="width: 50%"></div>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="startChat()">
                        ğŸ’¬ ØªØ­Ø¯Ø« Ù…Ø¹ Ù†Ø³Ø®ØªÙƒ
                    </button>
                    <button class="btn btn-danger" onclick="startConfrontation()">
                        âš”ï¸ Ù…ÙˆØ§Ø¬Ù‡Ø© Ù†ÙØ³Ùƒ
                    </button>
                    <button class="btn btn-secondary" onclick="resetApp()">
                        ğŸ”„ Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø®ØµÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
                    </button>
                </div>
            </div>
        </section>

        <!-- Section 3: Chat -->
        <section class="section" id="chatSection">
            <div class="chat-container">
                <div class="chat-header">
                    <div class="chat-user-info">
                        <div class="chat-avatar" id="chatAvatar">ğŸ¤–</div>
                        <div>
                            <div style="font-weight: 700;" id="chatName">Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</div>
                            <div style="font-size: 0.85rem; color: #10b981;">â— Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</div>
                        </div>
                    </div>
                    <div class="emotion-meter">
                        <span class="emotion" id="emoAngry">ğŸ˜¡</span>
                        <span class="emotion" id="emoNeutral">ğŸ˜</span>
                        <span class="emotion active" id="emoHappy">ğŸ™‚</span>
                        <span class="emotion" id="emoExcited">ğŸ¤©</span>
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages">
                    <div class="message ai">
                        <div class="message-header">Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</div>
                        <div>Ø£Ù‡Ù„Ø§Ù‹! Ø£Ù†Ø§ Ù†Ø³Ø®ØªÙƒ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©. Ø¬Ø±Ø¨ ØªÙƒÙ„Ù…Ù†ÙŠ ÙˆØ£Ø´ÙˆÙ Ù‡Ø±Ø¯ Ø¹Ù„ÙŠÙƒ Ø¥Ø²Ø§ÙŠ! ğŸ˜</div>
                    </div>
                </div>

                <div class="quick-replies" id="quickReplies">
                    <span class="quick-reply" onclick="sendQuickMessage('Ù†Ø®Ø±Ø¬ØŸ')">Ù†Ø®Ø±Ø¬ØŸ</span>
                    <span class="quick-reply" onclick="sendQuickMessage('Ø¹Ù†Ø¯ÙŠ Ù…Ø´ÙƒÙ„Ø©')">Ø¹Ù†Ø¯ÙŠ Ù…Ø´ÙƒÙ„Ø©</span>
                    <span class="quick-reply" onclick="sendQuickMessage('Ø£Ù†Ø§ ØªØ¹Ø¨Ø§Ù†')">Ø£Ù†Ø§ ØªØ¹Ø¨Ø§Ù†</span>
                    <span class="quick-reply" onclick="sendQuickMessage('ÙØ±Ø­Ø§Ù† Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡!')">ÙØ±Ø­Ø§Ù† Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡!</span>
                </div>

                <div class="chat-input-area">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..." onkeypress="handleKeyPress(event)">
                    <button class="btn btn-primary" onclick="sendMessage()">
                        Ø¥Ø±Ø³Ø§Ù„ ğŸ“¤
                    </button>
                </div>
            </div>

            <div class="btn-group" style="margin-top: 20px;">
                <button class="btn btn-secondary" onclick="showResult()">
                    ğŸ”™ Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø´Ø®ØµÙŠØ©
                </button>
                <button class="btn btn-danger" onclick="startConfrontation()">
                    âš”ï¸ ÙˆØ¶Ø¹ Ø§Ù„Ù…ÙˆØ§Ø¬Ù‡Ø©
                </button>
            </div>
        </section>

        <!-- Section 4: Self Confrontation -->
        <section class="section" id="confrontationSection">
            <div class="card">
                <h2 style="text-align: center; margin-bottom: 20px; font-size: 2rem;">
                    âš”ï¸ Ù…ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù†ÙØ³
                </h2>
                <p style="text-align: center; color: #94a3b8; margin-bottom: 30px;">
                    Ø£Ù†Øª Ø¶Ø¯ Ù†Ø³Ø®ØªÙƒ Ø§Ù„Ø±Ù‚Ù…ÙŠØ© - Ø´ÙˆÙ Ù…ÙŠÙ† Ù‡ÙŠØºÙ„Ø¨ Ø§Ù„ØªØ§Ù†ÙŠ!
                </p>

                <div class="confrontation-container">
                    <div class="vs-badge">VS</div>
                    <div class="confrontation-mode">
                        <div class="confrontation-side you">
                            <div class="side-header">
                                <div style="font-size: 2.5rem; margin-bottom: 10px;">ğŸ‘¤</div>
                                <div style="font-weight: 700; color: var(--primary);">Ø£Ù†Øª</div>
                                <div style="font-size: 0.9rem; color: #64748b;" id="youName">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</div>
                            </div>
                            <div class="side-messages" id="youMessages"></div>
                            <div class="chat-input-area" style="margin-top: auto;">
                                <input type="text" class="chat-input" id="youInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." onkeypress="handleYouKeyPress(event)">
                                <button class="btn btn-primary" onclick="sendYouMessage()">Ø¥Ø±Ø³Ø§Ù„</button>
                            </div>
                        </div>

                        <div class="confrontation-side ai">
                            <div class="side-header">
                                <div style="font-size: 2.5rem; margin-bottom: 10px;" id="confrontAvatar">ğŸ¤–</div>
                                <div style="font-weight: 700; color: var(--secondary);">Ù†Ø³Ø®ØªÙƒ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</div>
                                <div style="font-size: 0.9rem; color: #64748b;" id="confrontName">Ø§Ù„Ù†Ø³Ø®Ø©</div>
                            </div>
                            <div class="side-messages" id="aiMessages"></div>
                            <div style="margin-top: auto; padding: 15px; text-align: center; color: #64748b; font-size: 0.9rem;">
                                Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© ØªØ±Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                            </div>
                        </div>
                    </div>
                </div>

                <div class="btn-group" style="margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="showChat()">
                        ğŸ’¬ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠ
                    </button>
                    <button class="btn btn-secondary" onclick="showResult()">
                        ğŸ”™ Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø´Ø®ØµÙŠØ©
                    </button>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Global Variables
        let currentPersonality = null;
        let currentMood = 'neutral';
        let chatHistory = [];
        let confrontationHistory = [];

        // Response Templates based on personality
        const responseTemplates = {
            calm: {
                insult: ["Ù…Ø´ Ù…Ø³ØªØ§Ù‡Ù„ Ø§Ù„Ø±Ø¯", "Ù‡Ø¹Ø¯ÙŠÙ‡Ø§ Ø§Ù„Ù…Ø±Ù‡ Ø¯ÙŠ", "Ø§Ù„Ø­Ù…Ø¯Ù„Ù„Ù‡ Ø¹Ù„Ù‰ ÙƒÙ„ Ø­Ø§Ù„ ğŸ§˜"],
                happy: ["Ø¯Ù‡ Ø¬Ù…ÙŠÙ„!", "Ù…Ø¨Ø³ÙˆØ· Ù„ÙŠÙƒ!", "ÙŠÙˆÙ… Ø³Ø¹ÙŠØ¯! ğŸ˜Š"],
                tired: ["Ù…Ø­ØªØ§Ø¬ Ø±Ø§Ø­Ø©", "Ù‡Ù†Ø§Ù… Ø´ÙˆÙŠØ©", "Ù…Ø´ Ù‚Ø§Ø¯Ø± ğŸ¥±"],
                work: ["Ù‡Ù†Ø¸Ù… ÙˆÙ‚ØªÙŠ", "Ù‡Ø¨Ø¯Ø£ Ø¨Ø§Ù„Ø£Ù‡Ù…", "Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ© ğŸ’ª"]
            },
            angry: {
                insult: ["Ù…ÙŠÙ† Ø¯Ù‡ Ø§Ù„Ù„ÙŠ Ø¨ÙŠØªÙƒÙ„Ù…ØŸ!", "Ù…Ø´ Ù‡Ø³ÙƒØª!", "Ø¹Ù†Ø¯Ùƒ Ø­Ù‚ ØªØªØ¹ØµØ¨ ğŸ˜¤"],
                happy: ["Ø£Ø®ÙŠØ±Ø§Ù‹ Ø­Ø§Ø¬Ø© Ø­Ù„ÙˆØ©!", "Ø¯Ù‡ Ø§Ù„Ù„ÙŠ ÙØ§Ø¶Ù„!", "ÙŠØ³Ø·Ø§! ğŸ˜"],
                tired: ["Ù…Ø´ Ù‚Ø§Ø¯Ø± Ø£ÙƒÙ…Ù„!", "ÙƒÙØ§ÙŠØ© ÙƒØ¯Ù‡", "Ø¹Ø§ÙŠØ² Ø£Ø±ÙŠØ­ ğŸ˜«"],
                work: ["Ù‡Ø´ØªØºÙ„ Ø¨Ø³ Ø²Ù‡Ù‚Øª!", "Ø´ØºÙ„ ØªØ§Ù†ÙŠØŸ!", "Ù‡Ø®Ù„ØµÙ‡ Ø¨Ø³Ø±Ø¹Ø© ğŸ˜¤"]
            },
            sarcastic: {
                insult: ["Ø£ÙˆÙ‡ØŒ Ø¨Ø±Ø§ÙÙˆ Ø¹Ù„ÙŠÙƒ", "Ø§Ù†Øª Ø¸Ø±ÙŠÙ Ø£ÙˆÙŠ", "Ù…Ø´ Ø¹Ø§Ø±Ù Ø£Ø¶Ø­Ùƒ ÙˆÙ„Ø§ Ø£Ø¹ÙŠØ· ğŸ˜"],
                happy: ["Ù…Ø¨Ø±ÙˆÙƒØŒ Ø§ØªÙØ±Ø­ØªØŸ", "Ø¯Ù‡ Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø¹Ù…Ø±", "ÙˆØ§ÙˆØŒ Ù… nadie Ø´Ø§ÙÙ‡Ø§ Ù‚Ø¨Ù„ ÙƒØ¯Ù‡"],
                tired: ["Ø£Ù†Ø§ ÙƒÙˆÙŠØ³ØŒ Ø¥Ù†Øª ÙƒÙˆÙŠØ³ØŒ Ø§Ù„ÙƒÙ„ ÙƒÙˆÙŠØ³ ğŸ™‚", "Ø§Ù„Ø­ÙŠØ§Ø© Ø­Ù„ÙˆØ© Ø£ÙˆÙŠ", "Ù‡ØªØ¹ÙˆØ¯ Ø¹Ù„Ù‰ ÙƒØ¯Ù‡"],
                work: ["Ø´ØºÙ„ØŸ ÙÙŠ Ø§Ù„Ø¬Ù†Ø©ØŸ", "Ø£ÙˆÙ‡ØŒ Ø­Ù„Ù… Ø­ÙŠØ§ØªÙŠ", "ÙŠØ§Ø±ÙŠØªÙ†ÙŠ Ø±ÙˆØ¨ÙˆØª ÙØ¹Ù„Ø§Ù‹"]
            },
            smart: {
                insult: ["Ù†Ù‚Ø¯Ø± Ù†Ø­Ù„ Ø¯Ù‡ Ø¨Ø­ÙˆØ§Ø±", "ÙÙ‡Ù… ÙˆØ¬Ù‡Ø© Ù†Ø¸Ø±Ùƒ", "Ù†ÙÙƒØ± ÙÙŠ Ø­Ù„ ğŸ§ "],
                happy: ["ÙØ±ØµØ© Ù„Ù„ØªØ·ÙˆØ±", "Ù†Ø³ØªÙÙŠØ¯ Ù…Ù† Ø¯Ù‡", "ØªØ¹Ù„Ù… Ø¬Ø¯ÙŠØ¯! ğŸ“š"],
                tired: ["Ù…Ø­ØªØ§Ø¬ recharge", "Ø§Ù„Ø±Ø§Ø­Ø© Ø¶Ø±ÙˆØ±ÙŠØ©", "quality over quantity"],
                work: ["Ù‡Ø®Ø·Ø· Ù„Ù„Ù…Ù‡Ø§Ù…", "Ù†Ø±ØªØ¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª", "ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ Ù…Ù‡Ù… ğŸ¤"]
            }
        };

        // Mood System
        const moods = {
            angry: { emoji: 'ğŸ˜¡', text: 'Ø¹ØµØ¨ÙŠ', color: '#ef4444' },
            neutral: { emoji: 'ğŸ˜', text: 'Ù…Ø­Ø§ÙŠØ¯', color: '#94a3b8' },
            happy: { emoji: 'ğŸ™‚', text: 'Ø³Ø¹ÙŠØ¯', color: '#10b981' },
            excited: { emoji: 'ğŸ¤©', text: 'Ù…ØªØ­Ù…Ø³', color: '#f59e0b' }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadSavedPersonality();
        });

        // Generate Personality
        function generatePersonality() {
            const name = document.getElementById('userName').value.trim();
            if (!name) {
                alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹!');
                return;
            }

            const insult = document.getElementById('insultReaction').value;
            const friends = document.getElementById('friendsReaction').value;
            const work = document.getElementById('workReaction').value;
            const help = document.getElementById('helpReaction').value;
            const extra = document.getElementById('extraDescription').value;

            // Calculate stats
            const stats = calculateStats(insult, friends, work, help);
            
            // Generate digital name
            const digitalName = generateDigitalName(name, stats);
            
            // Generate speaking style
            const speakingStyle = generateSpeakingStyle(stats);

            currentPersonality = {
                userName: name,
                digitalName: digitalName,
                speakingStyle: speakingStyle,
                stats: stats,
                reactions: { insult, friends, work, help },
                extra: extra,
                createdAt: new Date().toISOString()
            };

            // Save to localStorage
            savePersonality(currentPersonality);

            // Display result
            displayResult(currentPersonality);
            
            // Switch section
            showSection('resultSection');
        }

        function calculateStats(insult, friends, work, help) {
            let anger = 50, kindness = 50, intelligence = 50, social = 50;

            // Insult reaction
            switch(insult) {
                case 'calm': anger -= 20; intelligence += 10; break;
                case 'angry': anger += 30; kindness -= 10; break;
                case 'sarcastic': intelligence += 15; anger += 5; break;
                case 'smart': intelligence += 20; anger -= 10; break;
            }

            // Friends reaction
            switch(friends) {
                case 'excited': social += 25; kindness += 10; break;
                case 'tired': social -= 15; anger += 5; break;
                case 'busy': intelligence += 10; social -= 10; break;
                case 'maybe': intelligence += 5; break;
            }

            // Work reaction
            switch(work) {
                case 'enthusiastic': kindness += 15; intelligence += 5; break;
                case 'cautious': intelligence += 20; anger -= 5; break;
                case 'stressed': anger += 20; kindness -= 5; break;
                case 'confident': intelligence += 15; social += 10; break;
            }

            // Help reaction
            switch(help) {
                case 'immediate': kindness += 25; anger -= 10; break;
                case 'check': intelligence += 10; break;
                case 'guide': intelligence += 20; kindness += 5; break;
                case 'delegate': intelligence += 15; social += 10; break;
            }

            // Clamp values
            return {
                anger: Math.max(0, Math.min(100, anger)),
                kindness: Math.max(0, Math.min(100, kindness)),
                intelligence: Math.max(0, Math.min(100, intelligence)),
                social: Math.max(0, Math.min(100, social))
            };
        }

        function generateDigitalName(name, stats) {
            const prefixes = {
                highInt: ['Ø§Ù„Ø¨Ø±ÙˆÙÙŠØ³ÙˆØ±', 'Ø§Ù„Ø¹Ø¨Ù‚Ø±ÙŠ', 'Ø§Ù„Ù…ÙÙƒØ±', 'Ø§Ù„ strategists'],
                highSocial: ['Ø§Ù„Ù†Ø¬Ù…', 'Ø§Ù„Ù…Ø­Ø¨ÙˆØ¨', 'Ø§Ù„Ù‚Ø§Ø¦Ø¯', 'Ø§Ù„social'],
                highKind: ['Ø§Ù„Ø·ÙŠØ¨', 'Ø§Ù„Ø­Ù†ÙˆÙ†', 'Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯', 'Ø§Ù„Ø±Ø­ÙŠÙ…'],
                highAnger: ['Ø§Ù„Ø¹Ø§ØµÙØ©', 'Ø§Ù„Ø´Ø±Ø³', 'Ø§Ù„Ù‚ÙˆÙŠ', 'Ø§Ù„Ø¬Ø¨Ø§Ø±']
            };

            const suffixes = ['Ø§Ù„Ø±Ù‚Ù…ÙŠ', '2.0', 'AI', 'Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ', 'Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ'];

            let prefix = '';
            if (stats.intelligence > 70) prefix = prefixes.highInt[Math.floor(Math.random() * prefixes.highInt.length)];
            else if (stats.social > 70) prefix = prefixes.highSocial[Math.floor(Math.random() * prefixes.highSocial.length)];
            else if (stats.kindness > 70) prefix = prefixes.highKind[Math.floor(Math.random() * prefixes.highKind.length)];
            else if (stats.anger > 70) prefix = prefixes.highAnger[Math.floor(Math.random() * prefixes.highAnger.length)];
            else prefix = 'Ø§Ù„Ø°ÙƒÙŠ';

            const suffix = suffixes[Math.floor(Math.random() * suffixes.length)];
            return `${prefix} ${name} ${suffix}`;
        }

        function generateSpeakingStyle(stats) {
            const styles = [];
            if (stats.intelligence > 60) styles.push('ÙŠØ³ØªØ®Ø¯Ù… ÙƒÙ„Ù…Ø§Øª Ø¹Ù…ÙŠÙ‚Ø©');
            if (stats.social > 60) styles.push('ÙŠØ­Ø¨ Ø§Ù„Ø¶Ø­Ùƒ ÙˆØ§Ù„Ù‡Ø²Ø§Ø±');
            if (stats.kindness > 60) styles.push('Ø·ÙŠØ¨ ÙÙŠ Ø§Ù„ØªØ¹Ø§Ù…Ù„');
            if (stats.anger > 60) styles.push('Ù…Ø¨Ø§Ø´Ø± ÙˆØµØ±ÙŠØ­');
            if (styles.length === 0) styles.push('Ù…ØªÙˆØ§Ø²Ù† ÙÙŠ Ø§Ù„ÙƒÙ„Ø§Ù…');
            return styles.join(' â€¢ ');
        }

        function displayResult(personality) {
            document.getElementById('digitalName').textContent = personality.digitalName;
            document.getElementById('speakingStyle').textContent = personality.speakingStyle;
            
            // Update stats with animation
            updateStat('anger', personality.stats.anger);
            updateStat('kindness', personality.stats.kindness);
            updateStat('intelligence', personality.stats.intelligence);
            updateStat('social', personality.stats.social);

            // Update avatars
            const avatarEmoji = personality.stats.social > 60 ? 'ğŸ˜' : 
                               personality.stats.intelligence > 60 ? 'ğŸ§ ' :
                               personality.stats.anger > 60 ? 'ğŸ˜¤' : 'ğŸ¤–';
            document.getElementById('resultAvatar').textContent = avatarEmoji;
            document.getElementById('chatAvatar').textContent = avatarEmoji;
            document.getElementById('confrontAvatar').textContent = avatarEmoji;
            document.getElementById('chatName').textContent = personality.digitalName;
            document.getElementById('confrontName').textContent = personality.digitalName;
            document.getElementById('youName').textContent = personality.userName;
        }

        function updateStat(type, value) {
            document.getElementById(`${type}Value`).textContent = value + '%';
            setTimeout(() => {
                document.getElementById(`${type}Bar`).style.width = value + '%';
            }, 100);
        }

        // Chat System
        function startChat() {
            showSection('chatSection');
            document.getElementById('moodIndicator').classList.remove('hidden');
            updateMood('happy');
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            input.value = '';

            // Show typing indicator
            showTyping();

            // Generate response
            setTimeout(() => {
                removeTyping();
                const response = generateAIResponse(message);
                addMessage(response, 'ai');
                updateMoodBasedOnMessage(message);
            }, 1000 + Math.random() * 1000);
        }

        function sendQuickMessage(message) {
            document.getElementById('chatInput').value = message;
            sendMessage();
        }

        function addMessage(text, sender) {
            const container = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const header = sender === 'ai' ? currentPersonality.digitalName : 'Ø£Ù†Øª';
            messageDiv.innerHTML = `
                <div class="message-header">${header}</div>
                <div>${text}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
            
            chatHistory.push({ sender, text, time: new Date() });
        }

        function showTyping() {
            const container = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
            container.appendChild(typingDiv);
            container.scrollTop = container.scrollHeight;
        }

        function removeTyping() {
            const typing = document.getElementById('typingIndicator');
            if (typing) typing.remove();
        }

        function generateAIResponse(userMessage) {
            const msg = userMessage.toLowerCase();
            const reaction = currentPersonality.reactions;
            const stats = currentPersonality.stats;

            // Determine context
            let context = 'neutral';
            if (msg.includes('Ø®Ø±Ø¬') || msg.includes('Ù†Ø±ÙˆØ­') || msg.includes('Ù†Ø·Ù„Ø¹')) context = 'social';
            else if (msg.includes('Ø´ØºÙ„') || msg.includes('Ù…Ù‡Ù…Ø©') || msg.includes('Ø¹Ù…Ù„')) context = 'work';
            else if (msg.includes('Ù…Ø´ÙƒÙ„Ø©') || msg.includes('Ù…Ø³Ø§Ø¹Ø¯Ø©') || msg.includes('Ø³Ø§Ø¹Ø¯')) context = 'help';
            else if (msg.includes('ØªØ¹Ø¨Ø§Ù†') || msg.includes('Ù…Ø´ Ù‚Ø§Ø¯Ø±') || msg.includes('Ù†Ù‡Ø§Ø±')) context = 'mood';
            else if (msg.includes('ÙØ±Ø­Ø§Ù†') || msg.includes('Ù…Ø¨Ø³ÙˆØ·') || msg.includes('Ø³Ø¹ÙŠØ¯')) context = 'happy';

            // Generate response based on personality
            let responses = [];

            if (context === 'social') {
                if (reaction.friends === 'excited') responses = ['ÙŠÙ„Ø§ Ø¨ÙŠÙ†Ø§! ğŸ‰', 'Ù†Ø±ÙˆØ­ ÙÙŠÙ†ØŸ', 'Ù…Ø³ØªÙ†ÙŠÙƒ! ğŸ˜'];
                else if (reaction.friends === 'tired') responses = ['Ù…Ø´ Ù‚Ø§Ø¯Ø± Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡ ğŸ˜´', 'Ø¹Ù†Ø¯ÙŠ Ø´ØºÙ„', 'maybe next time'];
                else if (reaction.friends === 'busy') responses = ['Ø¹Ù†Ø¯ÙŠ deadlines', 'Ù‡ØªØ£Ø®Ø± Ø´ÙˆÙŠØ©', 'Ù‡Ø´ÙˆÙ ÙˆÙ‚ØªÙŠ'];
                else responses = ['Ù‡ÙÙƒØ± Ùˆ Ø£Ù‚ÙˆÙ„Ùƒ', 'depend Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙƒØ§Ù†', 'Ù…Ù…ÙƒÙ†'];
            }
            else if (context === 'work') {
                if (reaction.work === 'enthusiastic') responses = ['Ù†Ø¨Ø¯Ø£! ğŸ”¥', 'Ù…ØªØ­Ù…Ø³!', 'Ù‡Ù†Ù†Ø¬Ø­ ÙÙŠÙ‡'];
                else if (reaction.work === 'cautious') responses = ['Ù‡Ù†Ø¸Ø± ÙÙŠÙ‡ ÙƒÙˆÙŠØ³', 'Ù…Ø®Ø§Ø·Ø±Ù‡ØŸ', 'Ù…Ø­ØªØ§Ø¬ ØªÙØ§ØµÙŠÙ„ Ø£ÙƒØªØ±'];
                else if (reaction.work === 'stressed') responses = ['ÙƒÙ…Ø§Ù† Ø´ØºÙ„ØŸ ğŸ˜°', 'Ù‡ØªÙˆØªØ±', 'ØµØ¹Ø¨ Ø´ÙˆÙŠØ©'];
                else responses = ['Ù‡Ù†Ù‚Ø¯Ø± Ù†Ø¹Ù…Ù„Ù‡', 'no problem', 'Ù‡Ù†Ø®Ù„ØµÙ‡'];
            }
            else if (context === 'happy') {
                responses = ['Ù…Ø¨Ø±ÙˆÙƒ! ğŸ‰', 'ÙØ±Ø­Ø§Ù† Ù…Ø¹Ø§Ùƒ!', 'continues'];
            }
            else if (context === 'mood') {
                responses = ['Ø±ÙŠØ­ Ù†ÙØ³Ùƒ', 'Ù‡Ø¹Ø¯ÙŠ', 'Ù…Ø­ØªØ§Ø¬ break'];
            }
            else {
                // Default responses based on stats
                if (stats.intelligence > 60) responses = ['ÙÙ‡Ù…Øª', 'interesting point', 'Ù†ÙÙƒØ± ÙÙŠ Ø¯Ù‡'];
                else if (stats.social > 60) responses = ['ØµØ­!', 'ğŸ˜‚', 'Ø¨Ø§Ù„Ø¸Ø¨Ø·'];
                else if (stats.anger > 60) responses = ['ÙˆØ§Ø¶Ø­', 'ØªÙ…Ø§Ù…', 'Ù…Ø§Ø´ÙŠ'];
                else responses = ['Ø£ÙˆÙƒÙŠÙ‡', 'ØªÙ…Ø§Ù…', 'Ø­Ø§Ø¶Ø±'];
            }

            // Add personality flavor
            let response = responses[Math.floor(Math.random() * responses.length)];
            
            if (stats.sarcasm > 60 || currentPersonality.reactions.insult === 'sarcastic') {
                response += ' (obviously)';
            }
            
            return response;
        }

        function updateMoodBasedOnMessage(message) {
            const msg = message.toLowerCase();
            if (msg.includes('Ø¹ØµØ¨') || msg.includes('Ø²Ù‡Ù‚') || msg.includes('ØºØ¶Ø¨')) {
                updateMood('angry');
            } else if (msg.includes('ÙØ±Ø­') || msg.includes('Ø³Ø¹ÙŠØ¯') || msg.includes('Ø­Ø¨')) {
                updateMood('excited');
            } else if (msg.includes('Ø­Ø²ÙŠÙ†') || msg.includes('ØªØ¹Ø¨Ø§Ù†') || msg.includes('Ù…Ø´ÙƒÙ„Ø©')) {
                updateMood('neutral');
            } else {
                updateMood('happy');
            }
        }

        function updateMood(mood) {
            currentMood = mood;
            const moodData = moods[mood];
            
            document.getElementById('moodEmoji').textContent = moodData.emoji;
            document.getElementById('moodText').textContent = moodData.text;
            document.getElementById('moodIndicator').style.borderColor = moodData.color;

            // Update emotion meter
            document.querySelectorAll('.emotion').forEach(e => e.classList.remove('active'));
            document.getElementById(`emo${mood.charAt(0).toUpperCase() + mood.slice(1)}`).classList.add('active');
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter') sendMessage();
        }

        // Confrontation Mode
        function startConfrontation() {
            showSection('confrontationSection');
            document.getElementById('youMessages').innerHTML = '';
            document.getElementById('aiMessages').innerHTML = '';
            
            // Initial AI message
            setTimeout(() => {
                addConfrontationMessage('Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙŠÙƒ! Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…ÙˆØ§Ø¬Ù‡Ø©ØŸ ğŸ˜', 'ai');
            }, 500);
        }

        function sendYouMessage() {
            const input = document.getElementById('youInput');
            const message = input.value.trim();
            if (!message) return;

            addConfrontationMessage(message, 'you');
            input.value = '';

            // AI responds
            setTimeout(() => {
                const response = generateConfrontationResponse(message);
                addConfrontationMessage(response, 'ai');
            }, 1000 + Math.random() * 1000);
        }

        function addConfrontationMessage(text, side) {
            const container = document.getElementById(`${side}Messages`);
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.style.cssText = side === 'you' ? 
                'background: rgba(99, 102, 241, 0.2); border-radius: 15px; padding: 10px 15px; margin-bottom: 10px; align-self: flex-start; border-bottom-right-radius: 4px;' :
                'background: rgba(236, 72, 153, 0.2); border-radius: 15px; padding: 10px 15px; margin-bottom: 10px; align-self: flex-end; border-bottom-left-radius: 4px;';
            messageDiv.textContent = text;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        function generateConfrontationResponse(userMessage) {
            const msg = userMessage.toLowerCase();
            const stats = currentPersonality.stats;
            
            // Special confrontation responses
            if (msg.includes('Ø£Ø­Ø³Ù†') || msg.includes('Ø£ÙØ¶Ù„')) {
                return stats.anger > 50 ? 'Ø£Ù†Ø§ Ø§Ù„Ø£ÙØ¶Ù„ Ø·Ø¨Ø¹Ø§Ù‹! ğŸ˜¤' : 'ÙƒÙ„Ù†Ø§ Ù†Ø³Ø®Ø© Ù…Ù† Ø¨Ø¹Ø¶Ù†Ø§ ğŸ˜‰';
            }
            if (msg.includes('ØºÙ„Ø·') || msg.includes('Ø®Ø·Ø£')) {
                return stats.intelligence > 50 ? 'Ù†ÙÙƒØ± ØªØ§Ù†ÙŠØŸ ğŸ§ ' : 'Ù…Ø´ ØºÙ„Ø·! ğŸ˜¤';
            }
            if (msg.includes('ØµØ­') || msg.includes('ØµØ­ÙŠØ­')) {
                return 'Ø¹Ø±ÙØª Ø£Ø®ÙŠØ±Ø§Ù‹! ğŸ˜';
            }
            
            // Default confrontation
            const responses = [
                'Ù…ØªØ£ÙƒØ¯ØŸ ğŸ¤”',
                'ÙÙƒØ± ÙƒÙˆÙŠØ³! ğŸ§ ',
                'Ø¯Ù‡ Ø±Ø£ÙŠÙƒ ÙˆÙ„Ø§ Ø­Ù‚ÙŠÙ‚Ø©ØŸ',
                'Ø£Ù†Ø§ Ø£Ø¹Ø±ÙÙƒ Ø£ÙƒØªØ± Ù…Ù† Ù†ÙØ³Ùƒ! ğŸ˜',
                'Ù†ÙØ³ Ø§Ù„ÙƒÙ„Ø§Ù…!',
                'copycat! ğŸ˜„'
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function handleYouKeyPress(e) {
            if (e.key === 'Enter') sendYouMessage();
        }

        // Local Storage
        function savePersonality(personality) {
            const saved = JSON.parse(localStorage.getItem('digitalTwins') || '[]');
            saved.push(personality);
            localStorage.setItem('digitalTwins', JSON.stringify(saved));
            localStorage.setItem('currentTwin', JSON.stringify(personality));
        }

        function loadSavedPersonality() {
            const current = localStorage.getItem('currentTwin');
            if (current) {
                currentPersonality = JSON.parse(current);
            }
        }

        function showSavedPersonalities() {
            const saved = JSON.parse(localStorage.getItem('digitalTwins') || '[]');
            const list = document.getElementById('savedList');
            list.innerHTML = '';
            
            if (saved.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #64748b;">Ù…ÙÙŠØ´ Ø´Ø®ØµÙŠØ§Øª Ù…Ø­ÙÙˆØ¸Ø©</p>';
            } else {
                saved.slice().reverse().forEach((p, index) => {
                    const item = document.createElement('div');
                    item.className = 'saved-item';
                    item.innerHTML = `
                        <div class="saved-info">
                            <h3>${p.digitalName}</h3>
                            <p>ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date(p.createdAt).toLocaleDateString('ar-EG')}</p>
                        </div>
                        <button class="btn btn-primary" onclick="loadPersonality(${saved.length - 1 - index})">
                            ØªØ­Ù…ÙŠÙ„
                        </button>
                    `;
                    list.appendChild(item);
                });
            }
            
            document.getElementById('savedSection').classList.remove('hidden');
        }

        function hideSavedPersonalities() {
            document.getElementById('savedSection').classList.add('hidden');
        }

        function loadPersonality(index) {
            const saved = JSON.parse(localStorage.getItem('digitalTwins') || '[]');
            currentPersonality = saved[index];
            localStorage.setItem('currentTwin', JSON.stringify(currentPersonality));
            displayResult(currentPersonality);
            hideSavedPersonalities();
            showSection('resultSection');
        }

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            window.scrollTo(0, 0);
        }

        function showResult() {
            showSection('resultSection');
        }

        function showChat() {
            showSection('chatSection');
        }

        function resetApp() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø®ØµÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©ØŸ')) {
                document.getElementById('userName').value = '';
                document.getElementById('extraDescription').value = '';
                document.getElementById('chatMessages').innerHTML = `
                    <div class="message ai">
                        <div class="message-header">Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</div>
                        <div>Ø£Ù‡Ù„Ø§Ù‹! Ø£Ù†Ø§ Ù†Ø³Ø®ØªÙƒ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©. Ø¬Ø±Ø¨ ØªÙƒÙ„Ù…Ù†ÙŠ ÙˆØ£Ø´ÙˆÙ Ù‡Ø±Ø¯ Ø¹Ù„ÙŠÙƒ Ø¥Ø²Ø§ÙŠ! ğŸ˜</div>
                    </div>
                `;
                document.getElementById('moodIndicator').classList.add('hidden');
                showSection('createSection');
            }
        }
    </script>
</body>
</html>